<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿç”¢è€…å±¥æ­· - å€å¡Šéˆç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.4/web3.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>

        body { font-family: 'Microsoft JhengHei', sans-serif; background: #f4f7f6; margin: 0; padding: 0; }
        .container { max-width: 800px; margin: 30px auto; padding: 20px; }
        .profile-card { background: white; border-radius: 15px; padding: 30px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .avatar { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 5px solid #eee; }
        .loading { text-align: center; font-size: 1.5rem; color: #888; margin-top: 50px; }
    </style>
</head>
<body>

    <div class="container" id="content-area">
        <div class="loading">â³ æ­£åœ¨å¾å€å¡Šéˆè®€å–è¾²å¤«è³‡æ–™...</div>
    </div>

    <script>
  
        const contractAddress = "0x0136f45A37d68630e2C33Bd228C61F20b23a27a5";
        
        const contractABI = [
            { "inputs": [ { "internalType": "string", "name": "_name", "type": "string" } ], "name": "getFarmerProfile", "outputs": [ { "internalType": "string", "name": "", "type": "string" }, { "internalType": "string", "name": "", "type": "string" }, { "internalType": "string", "name": "", "type": "string" }, { "internalType": "string", "name": "", "type": "string" }, { "internalType": "string", "name": "", "type": "string" }, { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" }
        ];

        let web3, contract;

        window.onload = async function() {
            const params = new URLSearchParams(window.location.search);
            const farmerName = params.get('farmer');

            if (!farmerName) {
                document.getElementById('content-area').innerHTML = "âŒ ç¶²å€éŒ¯èª¤ï¼šæ²’æœ‰æŒ‡å®šè¾²å¤«åå­—";
                return;
            }

            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                contract = new web3.eth.Contract(contractABI, contractAddress);
                loadFarmerData(farmerName);
            } else {
                alert("è«‹å®‰è£ MetaMask");
            }
        };

        async function loadFarmerData(name) {
            try {
       
                const f = await contract.methods.getFarmerProfile(name).call();
    
                if (!f[5]) {
                    document.getElementById('content-area').innerHTML = `
                        <div style="text-align:center;">
                            <h1>ğŸš« æŸ¥ç„¡è³‡æ–™</h1>
                            <p>è¾²å¤« "${name}" å°šæœªåœ¨å€å¡Šéˆä¸Šå»ºç«‹å€‹äººæª”æ¡ˆã€‚</p>
                            <a href="javascript:history.back()">å›ä¸Šä¸€é </a>
                        </div>
                    `;
                    return;
                }

                document.getElementById('content-area').innerHTML = `
                    <div class="profile-card">
                        <img src="${f[3] || 'https://via.placeholder.com/150'}" class="avatar">
                        <h1 style="margin:10px 0;">${f[0]}</h1>
                        <div style="color:#2e7d32; font-weight:bold;">
                            <i class="fas fa-map-marker-alt"></i> ${f[1]}
                        </div>
                        <div style="background:#f9f9f9; padding:20px; margin:20px 0; text-align:left; line-height:1.6; border-radius:10px;">
                            <strong>è¾²å‹æ•…äº‹ï¼š</strong><br>${f[2]}
                        </div>
                        <div style="color:#555;">
                            <i class="fas fa-phone"></i> è¯çµ¡æ–¹å¼ï¼š${f[4]}
                        </div>
                        <br>
                        <a href="javascript:history.back()" style="color:#666;">â¬…ï¸ å›ä¸Šä¸€é </a>
                    </div>
                `;

            } catch (err) {
                console.error(err);
                document.getElementById('content-area').innerHTML = "âŒ è®€å–å¤±æ•—ï¼š" + err.message;
            }
        }
    </script>

</body>
</html>
